{% extends "base.html" %}

{% block content %}
<div class="shared-view-container">
    <div class="shared-header">
        <h2>{{ share.pdf_file.original_filename }}</h2>
        <p class="shared-by">Shared by {{ share.owner.username }}</p>
        
        <div class="share-info-banner">
            <div class="info-items">
                <span class="info-item">
                    <i class="fas fa-clock"></i>
                    {% if share.max_access_count > 0 %}
                        {{ share.max_access_count - share.current_access_count }} accesses remaining
                    {% else %}
                        Expires {{ share.expires_at.strftime('%Y-%m-%d') }}
                    {% endif %}
                </span>
                <span class="info-item">
                    <i class="fas fa-download"></i>
                    {{ "Download allowed" if share.allow_download else "View only" }}
                </span>
            </div>
        </div>
    </div>
    
    <div class="shared-actions">
        {% if share.allow_download %}
        <a href="{{ url_for('shared_download', share_token=share.share_token) }}" class="btn btn-primary">
            <i class="fas fa-download"></i> Download PDF
        </a>
        {% endif %}
        
        <button onclick="openPreview()" class="btn btn-secondary">
            <i class="fas fa-eye"></i> Preview
        </button>
    </div>
    
    <div class="pdf-preview-container">
        <iframe src="{{ url_for('shared_preview', share_token=share.share_token) }}#toolbar=0" 
                width="100%" 
                height="600px" 
                frameborder="0">
        </iframe>
    </div>
</div>

<!-- Preview Modal -->
<div id="previewModal" class="modal">
    <div class="modal-content large">
        <span class="close" onclick="closePreview()">&times;</span>
        <h3>Preview: {{ share.pdf_file.original_filename }}</h3>
        <div class="preview-container">
            <iframe src="{{ url_for('shared_preview', share_token=share.share_token) }}" 
                    width="100%" 
                    height="80vh" 
                    frameborder="0">
            </iframe>
        </div>
    </div>
</div>

<script>
function openPreview() {
    document.getElementById('previewModal').style.display = 'block';
}

function closePreview() {
    document.getElementById('previewModal').style.display = 'none';
}
</script>
{% endblock %}