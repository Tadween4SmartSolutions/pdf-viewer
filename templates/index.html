{% extends "base.html" %}

{% block title %}Home - PDF Viewer{% endblock %}

{% block head %}
<style>
/* Preview modal toolbar and spinner */
.preview-toolbar { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
.preview-toolbar button { padding:6px 10px; }
.preview-container-wrapper { overflow:auto; width:100%; height:600px; }
.preview-container-wrapper iframe { width:100%; height:100%; transform-origin: top left; }
.preview-container-wrapper canvas { width:100%; height:auto; display:block; }
.spinner { display:none; width:48px; height:48px; border:6px solid #f3f3f3; border-top:6px solid #3498db; border-radius:50%; animation:spin 1s linear infinite; margin:10px auto; }
@keyframes spin { from { transform:rotate(0deg);} to { transform:rotate(360deg);} }
</style>
{% endblock %}

{% block content %}
<div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search PDF files..." onkeyup="searchPDFs()">
    <i class="fas fa-search"></i>
</div>

<div class="pdf-grid" id="pdfGrid">
    {% for pdf in pdfs.items %}
    <div class="pdf-card" data-filename="{{ pdf.filename }}">
        <div class="pdf-icon">
            {% if pdf.get_thumbnail_url() %}
                <img class="pdf-thumb" src="{{ pdf.get_thumbnail_url() }}" alt="{{ pdf.original_filename }} thumbnail">
            {% else %}
                <i class="fas fa-file-pdf"></i>
            {% endif %}
        </div>
        <div class="pdf-info">
            <h3 class="pdf-title">{{ pdf.original_filename }}</h3>
            <p class="pdf-size">{{ (pdf.file_size / (1024*1024))|round(2) }} MB</p>
        </div>
        <div class="pdf-actions">
            <a href="{{ url_for('serve_pdf', filename=pdf.filename) }}" 
               target="_blank" 
               class="btn btn-primary" 
               title="Open PDF">
                <i class="fas fa-external-link-alt"></i>
            </a>
                <button class="btn btn-secondary preview-btn" 
                    data-filename="{{ pdf.filename }}"
                    data-pdf-id="{{ pdf.id }}"
                    title="Preview PDF">
                <i class="fas fa-eye"></i>
            </button>
             <!-- Add share button -->
            <a href="{{ url_for('share_pdf', pdf_id=pdf.id) }}" 
            class="btn btn-info" 
            title="Share PDF">
                <i class="fas fa-share-alt"></i>
            </a>

        </div>
    </div>
    {% else %}
    <div class="no-pdfs">
        <i class="fas fa-folder-open fa-3x"></i>
        <h3>No PDF files found</h3>
        <p>Add PDF files to the 'pdfs' folder to get started.</p>
    </div>
    {% endfor %}
</div>

<!-- Preview Modal -->
<div id="previewModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="previewTitle">PDF Preview</h2>
        <div class="preview-toolbar">
            <button class="btn" onclick="changePage(-1)" title="Previous page">&#8592;</button>
            <button class="btn" onclick="changePage(1)" title="Next page">&#8594;</button>
            <button class="btn" onclick="zoomOut()" title="Zoom out">-</button>
            <button class="btn" onclick="zoomIn()" title="Zoom in">+</button>
            <button class="btn" onclick="resetZoom()" title="Reset zoom">Reset</button>
            <span id="pageInfo" style="margin-left:auto"></span>
        </div>
        <div id="previewSpinner" class="spinner"></div>
        <div class="preview-container-wrapper">
            <div id="pdfjsViewer" style="width:100%; height:600px;">
                <canvas id="pdfCanvas" style="width:100%; height:auto; display:block;"></canvas>
            </div>
        </div>
        <div class="modal-actions">
            <a id="openPdfLink" href="#" target="_blank" class="btn btn-primary">
                <i class="fas fa-external-link-alt"></i> Open Full PDF
            </a>
            <button class="btn btn-secondary" onclick="closePreview()">Close</button>
        </div>
    </div>
</div>

<!-- Hover Preview Tooltip -->
<div id="hoverPreview" class="hover-preview">
    <div class="preview-header">
        <i class="fas fa-file-pdf"></i>
        <span id="previewFileName">filename.pdf</span>
    </div>
    <div class="preview-content">
        <p>Hover over buttons to see quick preview options</p>
    </div>
</div>
{% endblock %}