{% extends "base.html" %}

{% block content %}
<div class="manage-shares-container">
    <h2>Manage Shared Links</h2>
    
    <!-- Active Shares -->
    <div class="shares-section">
        <h3>Active Shares ({{ active_shares|length }})</h3>
        
        {% if active_shares %}
        <div class="shares-grid">
            {% for share in active_shares %}
            <div class="share-card">
                <div class="share-header">
                    <h4>{{ share.pdf_file.original_filename }}</h4>
                    <span class="status-badge active">Active</span>
                </div>
                
                <div class="share-details">
                    <div class="share-url">
                        <label>Share URL:</label>
                        <div class="url-display">
                            <input type="text" value="{{ share.get_share_url(request.host_url) }}" readonly>
                            <button onclick="copyShareUrl('{{ share.get_share_url(request.host_url) }}')" class="btn btn-copy">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="share-stats">
                        <div class="stat">
                            <strong>Created:</strong>
                            {{ share.created_at.strftime('%Y-%m-%d') }}
                        </div>
                        <div class="stat">
                            <strong>Expires:</strong>
                            {% if share.max_access_count > 0 %}
                                After {{ share.max_access_count }} accesses
                            {% else %}
                                {{ share.expires_at.strftime('%Y-%m-%d') }}
                            {% endif %}
                        </div>
                        <div class="stat">
                            <strong>Accesses:</strong>
                            {{ share.current_access_count }} / {{ share.max_access_count if share.max_access_count > 0 else 'âˆž' }}
                        </div>
                    </div>
                </div>
                
                <div class="share-actions">
                    <a href="{{ share.get_share_url(request.host_url) }}" target="_blank" class="btn btn-sm btn-primary">
                        <i class="fas fa-external-link-alt"></i> View
                    </a>
                    <form method="POST" action="{{ url_for('delete_share', share_id=share.id) }}" class="inline-form">
                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this share link?')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="no-shares">No active share links.</p>
        {% endif %}
    </div>
    
    <!-- Expired Shares -->
    <div class="shares-section">
        <h3>Expired Shares ({{ expired_shares|length }})</h3>
        
        {% if expired_shares %}
        <div class="shares-grid">
            {% for share in expired_shares %}
            <div class="share-card expired">
                <div class="share-header">
                    <h4>{{ share.pdf_file.original_filename }}</h4>
                    <span class="status-badge expired">Expired</span>
                </div>
                
                <div class="share-details">
                    <div class="share-stats">
                        <div class="stat">
                            <strong>Total Accesses:</strong>
                            {{ share.current_access_count }}
                        </div>
                        <div class="stat">
                            <strong>Last Accessed:</strong>
                            {{ share.last_accessed.strftime('%Y-%m-%d') if share.last_accessed else 'Never' }}
                        </div>
                    </div>
                </div>
                
                <div class="share-actions">
                    <form method="POST" action="{{ url_for('delete_share', share_id=share.id) }}" class="inline-form">
                        <button type="submit" class="btn btn-sm btn-danger">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="no-shares">No expired share links.</p>
        {% endif %}
    </div>
</div>

<script>
function copyShareUrl(url) {
    navigator.clipboard.writeText(url).then(function() {
        // Show temporary feedback
        const btn = event.target.closest('button');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i>';
        btn.classList.add('btn-success');
        
        setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.classList.remove('btn-success');
        }, 2000);
    });
}
</script>
{% endblock %}